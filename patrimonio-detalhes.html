<!-- 
Arquivo: patrimonio-detalhes.html
Dashboard Detalhado - Evolu√ß√£o Patrim√¥nio TOTAL (inclui BTC Core) + Distribui√ß√£o USD
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ BTC Turbo - Evolu√ß√£o Patrim√¥nio</title>
    <link rel="stylesheet" href="/src/styles/shared.css">
    <link rel="stylesheet" href="/src/styles/components.css">
    <style>
        .chart-container {
            background: #2a2f3e;
            border: 1px solid #3a3f4e;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            height: 400px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .period-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            background: #404552;
            color: #8b9dc3;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .period-btn:hover {
            background: #ff8c42;
            color: white;
        }
        
        .period-btn.active {
            background: #ff8c42;
            color: white;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-canvas {
            width: 100% !important;
            height: 320px !important;
        }
        
        .current-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .metric-card {
            background: #2a2f3e;
            border: 1px solid #3a3f4e;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #8b9dc3;
            font-size: 0.9rem;
        }
        
        .metric-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .positive { color: #4caf50; }
        .negative { color: #ff4757; }
        .neutral { color: #8b9dc3; }
        
        /* Gr√°fico de rosca - layout espec√≠fico */
        .distribution-chart-container {
            height: 270px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        /* FOR√áA alinhamento das labels - ambos centralizados */
        .chart-container canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: auto !important;
            height: auto !important;
        }

        /* FOR√áA legendas centralizadas para ambos os gr√°ficos */
        .chart-container .chartjs-legend,
        .chart-container ul {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            flex-direction: row !important;
            margin: 0 auto !important;
            text-align: center !important;
        }
        
        /* For√ßar cor das labels dos gr√°ficos de distribui√ß√£o */
        .chart-container .chartjs-legend-item,
        .chart-container .chartjs-legend-item span,
        .chart-container canvas + div,
        .chart-container canvas ~ div {
            color: #8b9dc3 !important;
        }
        
        .distribution-chart-container canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: auto !important;
            height: auto !important;
        }

        /* Grid para os gr√°ficos de distribui√ß√£o lado a lado */
        .distribution-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 350px;
                padding: 20px;
            }
            
            .chart-canvas {
                height: 270px !important;
            }
            
            .current-metrics {
                grid-template-columns: 1fr;
            }
            
            .chart-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .distribution-grid {
                grid-template-columns: 1fr;
            }
            
            /* Ocultar legendas dos gr√°ficos de linha no mobile */
            #chart-patrimonio-usd + .chartjs-legend,
            #chart-patrimonio-btc + .chartjs-legend {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header com navega√ß√£o -->
        <div class="back-button" onclick="window.location.href='/'">
            ‚Üê Voltar ao Dashboard
        </div>
        
        <div class="breadcrumb">
            <a href="/">Home</a> > Evolu√ß√£o Patrim√¥nio
        </div>

        <!-- Status com timestamp -->
        <div style="text-align: center; margin-bottom: 15px;">
            <div class="last-update" id="last-update-patrimonio">√öltima: --:--</div>
        </div>

        <!-- M√©tricas Atuais -->
        <div class="current-metrics">
            <div class="metric-card">
                <div class="metric-value" id="current-patrimonio-usd">$0</div>
                <div class="metric-label">Patrim√¥nio Total (USD)</div>
                <div class="metric-change" id="usd-change">--</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="current-patrimonio-btc">0.0000 BTC</div>
                <div class="metric-label">Patrim√¥nio Total (BTC)</div>
                <div class="metric-change" id="btc-change">--</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="current-btc-price">$0</div>
                <div class="metric-label">Pre√ßo BTC</div>
                <div class="metric-change" id="btc-price-change">--</div>
            </div>
        </div>

        <!-- Gr√°ficos de Distribui√ß√£o -->
        <div class="distribution-grid">
            <!-- Gr√°fico Distribui√ß√£o BTC -->
            <div class="chart-container" style="height: 350px;">
                <div class="chart-header">
                    <span class="chart-title">
                        <i class="bi bi-pie-chart"></i> Distribui√ß√£o BTC
                    </span>
                </div>
                <div class="distribution-chart-container">
                    <canvas id="chart-btc-distribution"></canvas>
                </div>
            </div>

            <!-- Gr√°fico Distribui√ß√£o USD -->
            <div class="chart-container" style="height: 350px;">
                <div class="chart-header">
                    <span class="chart-title">
                        <i class="bi bi-currency-dollar"></i> Distribui√ß√£o USD
                    </span>
                </div>
                <div class="distribution-chart-container">
                    <canvas id="chart-usd-distribution"></canvas>
                </div>
            </div>
        </div>

        <!-- Gr√°fico Patrim√¥nio USD -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-dollar"></i> Evolu√ß√£o Patrim√¥nio Total (USD)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioUsdPeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('1y')">1 Ano</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('all')">All</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-usd" class="chart-canvas"></canvas>
        </div>

        <!-- Gr√°fico Patrim√¥nio BTC -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-bitcoin"></i> Evolu√ß√£o Patrim√¥nio Total (BTC)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioBtcPeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('1y')">1 Ano</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('all')">All</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-btc" class="chart-canvas"></canvas>
        </div>
    </div>

    <script type="module" src="/src/pages/patrimonio-detalhes/index.js"></script>
    
    <script>
        // Fun√ß√µes globais para filtros de per√≠odo
        function loadPatrimonioUsdPeriod(period) {
            updatePeriodButtons('patrimonio-usd', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioUsdChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-usd');
            }
        }
        
        function loadPatrimonioBtcPeriod(period) {
            updatePeriodButtons('patrimonio-btc', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioBtcChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-btc');
            }
        }
        
        function updatePeriodButtons(chartType, activePeriod) {
            const chartId = chartType === 'patrimonio-usd' ? 'chart-patrimonio-usd' : 'chart-patrimonio-btc';
            const chart = document.getElementById(chartId);
            const container = chart?.closest('.chart-container');
            const buttons = container?.querySelectorAll('.period-btn');
            
            buttons?.forEach(btn => {
                btn.classList.remove('active');
                const onclick = btn.getAttribute('onclick');
                if (onclick?.includes(`'${activePeriod}'`)) {
                    btn.classList.add('active');
                }
            });
        }
        
        async function loadDataForPeriod(period, chartType) {
            if (window.patrimonioDetalhes) {
                try {
                    const response = await fetch(`https://btcturbo-prod.up.railway.app/api/v1/dash-finance/patrimonio?periodo=${period}`);
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        const formattedData = window.patrimonioDetalhes.dataHandler?.formatPatrimonioDetalhesData(data);
                        if (formattedData) {
                            if (chartType === 'patrimonio-usd') {
                                window.patrimonioDetalhes.components.patrimonioUsdChart.render(formattedData.patrimonioUsd);
                            } else {
                                window.patrimonioDetalhes.components.patrimonioBtcChart.render(formattedData.patrimonioBtc);
                            }
                        }
                    }
                } catch (error) {
                    console.error('Erro ao carregar per√≠odo:', error);
                }
            }
        }
    </script>
</body>
</html>