<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ BTC Turbo - Evolu√ß√£o Patrim√¥nio</title>
    <link rel="stylesheet" href="src/pages/patrimonio-detalhes/patrimonio-detalhes.css">
</head>
<body>
    <div class="container">
        <!-- Header com navega√ß√£o -->
        <div class="back-button" onclick="window.location.href='/'">
            ‚Üê Voltar ao Dashboard
        </div>
        
        <div class="breadcrumb">
            <a href="/">Home</a> > Evolu√ß√£o Patrim√¥nio
        </div>

        <!-- Status com timestamp -->
        <div style="text-align: center; margin-bottom: 15px;">
            <div class="last-update" id="last-update-patrimonio">√öltima: --:--</div>
        </div>

        <!-- M√©tricas Atuais - PC (3 cards) -->
        <div class="current-metrics">
            <div class="metric-card">
                <div class="metric-value" id="current-patrimonio-usd">$0</div>
                <div class="metric-label">Saldo Total USD</div>
                <div class="metric-change" id="usd-change">--</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="current-patrimonio-btc">0.0000 BTC</div>
                <div class="metric-label">Saldo Total BTC</div>
                <div class="metric-change" id="btc-change">--</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="current-btc-price">$0</div>
                <div class="metric-label">Pre√ßo BTC</div>
                <div class="metric-change" id="btc-price-change">--</div>
            </div>
        </div>

        <!-- M√©tricas Atuais - Mobile (card √∫nico compacto) -->
        <div class="current-metrics-mobile">
            <div class="metrics-compact-grid">
                <div class="metric-compact">
                    <div class="metric-compact-value" id="current-patrimonio-usd-mobile">$0</div>
                    <div class="metric-compact-label">Saldo Total USD</div>
                    <div class="metric-compact-change positive" id="usd-change-mobile">--</div>
                </div>
                
                <div class="metric-compact">
                    <div class="metric-compact-value" id="current-patrimonio-btc-mobile">0.0000</div>
                    <div class="metric-compact-label">Saldo Total BTC</div>
                    <div class="metric-compact-change positive" id="btc-change-mobile">--</div>
                </div>
                
                <div class="metric-compact">
                    <div class="metric-compact-value" id="current-btc-price-mobile">$0</div>
                    <div class="metric-compact-label">Pre√ßo BTC</div>
                    <div class="metric-compact-change positive" id="btc-price-change-mobile">--</div>
                </div>
            </div>
        </div>

        <!-- Gr√°ficos de Distribui√ß√£o -->
        <div class="distribution-grid">
            <!-- Gr√°fico Distribui√ß√£o BTC -->
            <div class="chart-container" style="height: 350px;">
                <div class="chart-header">
                    <span class="chart-title">
                        <i class="bi bi-pie-chart"></i> Distribui√ß√£o BTC
                    </span>
                </div>
                <div class="distribution-chart-container">
                    <canvas id="chart-btc-distribution"></canvas>
                </div>
            </div>

            <!-- Gr√°fico Distribui√ß√£o USD -->
            <div class="chart-container" style="height: 350px;">
                <div class="chart-header">
                    <span class="chart-title">
                        <i class="bi bi-currency-dollar"></i> Distribui√ß√£o USD
                    </span>
                </div>
                <div class="distribution-chart-container">
                    <canvas id="chart-usd-distribution"></canvas>
                </div>
            </div>
        </div>

        <!-- Gr√°fico Patrim√¥nio TOTAL USD -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-dollar"></i> Evolu√ß√£o Patrim√¥nio TOTAL (USD)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioUsdPeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdPeriod('1y')">1 Ano</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-usd" class="chart-canvas"></canvas>
        </div>

        <!-- Gr√°fico Patrim√¥nio TOTAL BTC -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-bitcoin"></i> Evolu√ß√£o Patrim√¥nio TOTAL (BTC)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioBtcPeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcPeriod('1y')">1 Ano</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-btc" class="chart-canvas"></canvas>
        </div>

        <!-- Gr√°fico Patrim√¥nio SAT√âLITE USD -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-dollar"></i> Evolu√ß√£o Patrim√¥nio SAT√âLITE (USD)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioUsdSatelitePeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdSatelitePeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdSatelitePeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioUsdSatelitePeriod('1y')">1 Ano</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-usd-satelite" class="chart-canvas"></canvas>
        </div>

        <!-- Gr√°fico Patrim√¥nio SAT√âLITE BTC -->
        <div class="chart-container">
            <div class="chart-header">
                <span class="chart-title">
                    <i class="bi bi-currency-bitcoin"></i> Evolu√ß√£o Patrim√¥nio SAT√âLITE (BTC)
                </span>
                <div class="period-filters">
                    <button class="period-btn active" onclick="loadPatrimonioBtcSatelitePeriod('30d')">30d</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcSatelitePeriod('3m')">3 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcSatelitePeriod('6m')">6 Meses</button>
                    <button class="period-btn" onclick="loadPatrimonioBtcSatelitePeriod('1y')">1 Ano</button>
                </div>
            </div>
            <canvas id="chart-patrimonio-btc-satelite" class="chart-canvas"></canvas>
        </div>
    </div>

    <script type="module" src="/src/pages/patrimonio-detalhes/index.js"></script>
    
    <script>
        // Fun√ß√µes globais para filtros de per√≠odo - TOTAIS
        function loadPatrimonioUsdPeriod(period) {
            updatePeriodButtons('chart-patrimonio-usd', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioUsdChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-usd');
            }
        }
        
        function loadPatrimonioBtcPeriod(period) {
            updatePeriodButtons('chart-patrimonio-btc', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioBtcChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-btc');
            }
        }

        // Fun√ß√µes globais para filtros de per√≠odo - SAT√âLITE
        function loadPatrimonioUsdSatelitePeriod(period) {
            updatePeriodButtons('chart-patrimonio-usd-satelite', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioUsdSateliteChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-usd-satelite');
            }
        }
        
        function loadPatrimonioBtcSatelitePeriod(period) {
            updatePeriodButtons('chart-patrimonio-btc-satelite', period);
            if (window.patrimonioDetalhes) {
                window.patrimonioDetalhes.components.patrimonioBtcSateliteChart.updatePeriod(period);
                loadDataForPeriod(period, 'patrimonio-btc-satelite');
            }
        }
        
        function updatePeriodButtons(chartId, activePeriod) {
            const chart = document.getElementById(chartId);
            const container = chart?.closest('.chart-container');
            const buttons = container?.querySelectorAll('.period-btn');
            
            buttons?.forEach(btn => {
                btn.classList.remove('active');
                const onclick = btn.getAttribute('onclick');
                if (onclick?.includes(`'${activePeriod}'`)) {
                    btn.classList.add('active');
                }
            });
        }
        
        async function loadDataForPeriod(period, chartType) {
            if (window.patrimonioDetalhes) {
                try {
                    const response = await fetch(`https://btcturbo-prod.up.railway.app/api/v1/dash-finance/patrimonio?periodo=${period}`);
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        const formattedData = window.patrimonioDetalhes.dataHandler?.formatPatrimonioDetalhesData(data);
                        if (formattedData) {
                            switch(chartType) {
                                case 'patrimonio-usd':
                                    window.patrimonioDetalhes.components.patrimonioUsdChart.render(formattedData.patrimonioUsd);
                                    break;
                                case 'patrimonio-btc':
                                    window.patrimonioDetalhes.components.patrimonioBtcChart.render(formattedData.patrimonioBtc);
                                    break;
                                case 'patrimonio-usd-satelite':
                                    window.patrimonioDetalhes.components.patrimonioUsdSateliteChart.render(formattedData.patrimonioUsdSatelite);
                                    break;
                                case 'patrimonio-btc-satelite':
                                    window.patrimonioDetalhes.components.patrimonioBtcSateliteChart.render(formattedData.patrimonioBtcSatelite);
                                    break;
                            }
                        }
                    }
                } catch (error) {
                    console.error('Erro ao carregar per√≠odo:', error);
                }
            }
        }
    </script>
</body>
</html>